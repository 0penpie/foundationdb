<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Configuration &#8212; FoundationDB 5.1</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-3.3.4/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-3.3.4/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '5.1.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.3.4/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="search" title="Search" href="search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          FoundationDB</a>
        <span class="navbar-text navbar-version pull-left"><b>5.1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="contents.html">Site Map</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"></ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Configuration</a><ul>
<li><a class="reference internal" href="#system-requirements">System requirements</a></li>
<li><a class="reference internal" href="#choosing-coordination-servers">Choosing coordination servers</a></li>
<li><a class="reference internal" href="#changing-coordination-servers">Changing coordination servers</a></li>
<li><a class="reference internal" href="#changing-the-cluster-description">Changing the cluster description</a></li>
<li><a class="reference internal" href="#the-configuration-file">The configuration file</a><ul>
<li><a class="reference internal" href="#fdbmonitor-section"><code class="docutils literal"><span class="pre">[fdbmonitor]</span></code> section</a></li>
<li><a class="reference internal" href="#general-section"><code class="docutils literal"><span class="pre">[general]</span></code> section</a></li>
<li><a class="reference internal" href="#fdbserver-section"><code class="docutils literal"><span class="pre">[fdbserver]</span></code> section</a></li>
<li><a class="reference internal" href="#fdbserver-id-section-s"><code class="docutils literal"><span class="pre">[fdbserver.&lt;ID&gt;]</span></code> section(s)</a></li>
<li><a class="reference internal" href="#backup-agent-sections">Backup agent sections</a></li>
</ul>
</li>
<li><a class="reference internal" href="#choosing-a-redundancy-mode">Choosing a redundancy mode</a><ul>
<li><a class="reference internal" href="#single-datacenter-modes">Single datacenter modes</a></li>
<li><a class="reference internal" href="#datacenter-aware-mode">Datacenter-aware mode</a></li>
<li><a class="reference internal" href="#changing-redundancy-mode">Changing redundancy mode</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configuring-the-storage-subsystem">Configuring the storage subsystem</a><ul>
<li><a class="reference internal" href="#storage-engines">Storage engines</a></li>
<li><a class="reference internal" href="#storage-locations">Storage locations</a></li>
<li><a class="reference internal" href="#ssd-considerations">SSD considerations</a></li>
<li><a class="reference internal" href="#filesystem">Filesystem</a></li>
<li><a class="reference internal" href="#durability-and-caching">Durability and caching</a></li>
<li><a class="reference internal" href="#disk-partitioning">Disk partitioning</a></li>
</ul>
</li>
<li><a class="reference internal" href="#guidelines-for-setting-process-class">Guidelines for setting process class</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
              
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><ul>
<li><a class="reference internal" href="#">Configuration</a><ul>
<li><a class="reference internal" href="#system-requirements">System requirements</a></li>
<li><a class="reference internal" href="#choosing-coordination-servers">Choosing coordination servers</a></li>
<li><a class="reference internal" href="#changing-coordination-servers">Changing coordination servers</a></li>
<li><a class="reference internal" href="#changing-the-cluster-description">Changing the cluster description</a></li>
<li><a class="reference internal" href="#the-configuration-file">The configuration file</a><ul>
<li><a class="reference internal" href="#fdbmonitor-section"><code class="docutils literal"><span class="pre">[fdbmonitor]</span></code> section</a></li>
<li><a class="reference internal" href="#general-section"><code class="docutils literal"><span class="pre">[general]</span></code> section</a></li>
<li><a class="reference internal" href="#fdbserver-section"><code class="docutils literal"><span class="pre">[fdbserver]</span></code> section</a></li>
<li><a class="reference internal" href="#fdbserver-id-section-s"><code class="docutils literal"><span class="pre">[fdbserver.&lt;ID&gt;]</span></code> section(s)</a></li>
<li><a class="reference internal" href="#backup-agent-sections">Backup agent sections</a></li>
</ul>
</li>
<li><a class="reference internal" href="#choosing-a-redundancy-mode">Choosing a redundancy mode</a><ul>
<li><a class="reference internal" href="#single-datacenter-modes">Single datacenter modes</a></li>
<li><a class="reference internal" href="#datacenter-aware-mode">Datacenter-aware mode</a></li>
<li><a class="reference internal" href="#changing-redundancy-mode">Changing redundancy mode</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configuring-the-storage-subsystem">Configuring the storage subsystem</a><ul>
<li><a class="reference internal" href="#storage-engines">Storage engines</a></li>
<li><a class="reference internal" href="#storage-locations">Storage locations</a></li>
<li><a class="reference internal" href="#ssd-considerations">SSD considerations</a></li>
<li><a class="reference internal" href="#filesystem">Filesystem</a></li>
<li><a class="reference internal" href="#durability-and-caching">Durability and caching</a></li>
<li><a class="reference internal" href="#disk-partitioning">Disk partitioning</a></li>
</ul>
</li>
<li><a class="reference internal" href="#guidelines-for-setting-process-class">Guidelines for setting process class</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    <div class="col-md-9 content">
      
  <div class="section" id="configuration">
<h1>Configuration</h1>
<p>This document contains <em>reference</em> information for configuring a new FoundationDB cluster. We recommend that you read this document before setting up a cluster for performance testing or production use. For <em>step-by-step instructions</em> to follow when setting up a cluster, see <a class="reference internal" href="building-cluster.html"><span class="doc">Building a Cluster</span></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In FoundationDB, a &#8220;cluster&#8221; refers to one or more FoundationDB processes spread across one or more physical machines that together host a FoundationDB database.</p>
</div>
<p>To plan an externally accessible cluster, you need to understand some basic aspects of the system. You can start by reviewing the <a class="reference internal" href="#system-requirements"><span class="std std-ref">system requirements</span></a>, then how to <a class="reference internal" href="#configuration-choosing-coordination-servers"><span class="std std-ref">choose</span></a> and <a class="reference internal" href="#configuration-changing-coordination-servers"><span class="std std-ref">change coordination servers</span></a>. Next, you should look at the <a class="reference internal" href="#foundationdb-conf"><span class="std std-ref">configuration file</span></a>, which controls most other aspects of the system. Then, you should understand how to <a class="reference internal" href="#configuration-choosing-redundancy-mode"><span class="std std-ref">choose a redundancy mode</span></a> and <a class="reference internal" href="#configuration-configuring-storage-subsystem"><span class="std std-ref">configure the storage subsystem</span></a>. Finally, there are some guidelines for setting <a class="reference internal" href="#guidelines-process-class-config"><span class="std std-ref">process class configurations</span></a>.</p>
<div class="section" id="system-requirements">
<span id="id1"></span><h2>System requirements</h2>
<ul>
<li><p class="first">One of the following 64-bit operating systems:</p>
<ul class="simple">
<li>A supported Linux distribution:<ul>
<li>RHEL/CentOS 6.x and 7.x</li>
<li>Ubuntu 12.04 or later (but see <a class="reference internal" href="platforms.html#platform-ubuntu-12"><span class="std std-ref">Platform Issues for Ubuntu 12.x</span></a>)</li>
</ul>
</li>
<li>Or, an unsupported Linux distribution with:<ul>
<li>Kernel version between 2.6.33 and 3.0.x (inclusive) or 3.7 or greater</li>
<li>Works with .deb or .rpm packages</li>
</ul>
</li>
<li>Or, macOS 10.7 or later</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The macOS version of the FoundationDB server is intended for use on locally accessible development machines only. Other uses are not supported.</p>
</div>
</li>
<li><p class="first">4GB <strong>ECC</strong> RAM (per fdbserver process)</p>
</li>
<li><p class="first">Storage</p>
<ul class="simple">
<li>SSDs are required when storing data sets larger than memory (using the <code class="docutils literal"><span class="pre">ssd</span></code> storage engine).</li>
<li>HDDs are OK when storing data sets smaller than memory (using the <code class="docutils literal"><span class="pre">memory</span></code> storage engine).</li>
<li>For more information, see <a class="reference internal" href="#configuration-configuring-storage-subsystem"><span class="std std-ref">Configuring the storage subsystem</span></a>.</li>
</ul>
</li>
</ul>
<p>For a description of issues on particular platforms that affect the operation of FoundationDB, see <a class="reference internal" href="platforms.html"><span class="doc">Platform Issues</span></a>.</p>
</div>
<div class="section" id="choosing-coordination-servers">
<span id="configuration-choosing-coordination-servers"></span><h2>Choosing coordination servers</h2>
<p>FoundationDB uses a set of <em>coordination servers</em> (or <em>coordinators</em> for short) to maximize the fault tolerance (and, in particular, the availability) of the cluster. The coordinators work by communicating and storing a small amount of shared state. If one or more machines are down or unable to communicate with the network, the cluster may become partitioned. In that event, FoundationDB selects the partition in which a majority of coordinators are reachable as the one that will remain available.</p>
<p>Any FoundationDB process can be used as a coordinator for any set of clusters. The performance impact of acting as a coordinator is negligible. The coordinators aren&#8217;t involved at all in committing transactions.</p>
<p>Administrators should choose the number and physical location of coordinators to maximize fault tolerance. Most configurations should follow these guidelines:</p>
<ul class="simple">
<li>Choose an odd number of coordinators.</li>
<li>Use enough coordinators to complement the <a class="reference internal" href="#configuration-choosing-redundancy-mode"><span class="std std-ref">redundancy mode</span></a> of the cluster, often 3 or 5.</li>
<li>Place coordinators in different racks, circuits, or datacenters with independence of failure.</li>
<li>It is OK to place coordinators in distant datacenters; in normal operation the latency to a coordinator does not affect system latency.</li>
</ul>
<p>The set of coordinators is stored on each client and server in the <a class="reference internal" href="administration.html#foundationdb-cluster-file"><span class="std std-ref">cluster file</span></a>.</p>
</div>
<div class="section" id="changing-coordination-servers">
<span id="configuration-changing-coordination-servers"></span><h2>Changing coordination servers</h2>
<p>It is sometimes necessary to change the set of coordinators servers. You may want to do so because of changing network conditions, machine failures, or just planning adjustments. You can change coordinators using an automated <code class="docutils literal"><span class="pre">fdbcli</span></code> command. FoundationDB will maintain ACID guarantees during the changes.</p>
<p>You can change coordinators when the following conditions are met:</p>
<ul class="simple">
<li>a majority of the current coordinators are available;</li>
<li>all of the new coordinators are available; and</li>
<li>client and server cluster files are writable.</li>
</ul>
<p><code class="docutils literal"><span class="pre">fdbcli</span></code> supports a <code class="docutils literal"><span class="pre">coordinators</span></code> command to specify the new list of coordinators:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>user@host$ fdbcli
Using cluster file `/etc/foundationdb/fdb.cluster&#39;.

The database is available.

Welcome to the fdbcli. For help, type `help&#39;.
fdb&gt; coordinators 10.0.4.1:4500 10.0.4.2:4500 10.0.4.3:4500
Coordinators changed
</pre></div>
</div>
<p>After running this command, you can check that it completed successfully by using the <code class="docutils literal"><span class="pre">status</span> <span class="pre">details</span></code> command:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">fdb</span><span class="o">&gt;</span> <span class="n">status</span> <span class="n">details</span>

<span class="n">Configuration</span><span class="p">:</span>
  <span class="n">Redundancy</span> <span class="n">mode</span>        <span class="o">-</span> <span class="n">triple</span>
  <span class="n">Storage</span> <span class="n">engine</span>         <span class="o">-</span> <span class="n">ssd</span>
  <span class="n">Coordinators</span>           <span class="o">-</span> <span class="mi">3</span>

<span class="n">Cluster</span><span class="p">:</span>
  <span class="n">FoundationDB</span> <span class="n">processes</span> <span class="o">-</span> <span class="mi">3</span>
  <span class="n">Machines</span>               <span class="o">-</span> <span class="mi">3</span>
  <span class="n">Memory</span> <span class="n">availability</span>    <span class="o">-</span> <span class="mf">4.1</span> <span class="n">GB</span> <span class="n">per</span> <span class="n">process</span> <span class="n">on</span> <span class="n">machine</span> <span class="k">with</span> <span class="n">least</span> <span class="n">available</span>
  <span class="n">Fault</span> <span class="n">Tolerance</span>        <span class="o">-</span> <span class="mi">0</span> <span class="n">machines</span>
  <span class="n">Server</span> <span class="n">time</span>            <span class="o">-</span> <span class="n">Thu</span> <span class="n">Mar</span> <span class="mi">15</span> <span class="mi">14</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">34</span> <span class="mi">2018</span>

<span class="n">Data</span><span class="p">:</span>
  <span class="n">Replication</span> <span class="n">health</span>     <span class="o">-</span> <span class="n">Healthy</span>
  <span class="n">Moving</span> <span class="n">data</span>            <span class="o">-</span> <span class="mf">0.000</span> <span class="n">GB</span>
  <span class="n">Sum</span> <span class="n">of</span> <span class="n">key</span><span class="o">-</span><span class="n">value</span> <span class="n">sizes</span> <span class="o">-</span> <span class="mi">8</span> <span class="n">MB</span>
  <span class="n">Disk</span> <span class="n">space</span> <span class="n">used</span>        <span class="o">-</span> <span class="mi">103</span> <span class="n">MB</span>

<span class="n">Operating</span> <span class="n">space</span><span class="p">:</span>
  <span class="n">Storage</span> <span class="n">server</span>         <span class="o">-</span> <span class="mf">1.0</span> <span class="n">GB</span> <span class="n">free</span> <span class="n">on</span> <span class="n">most</span> <span class="n">full</span> <span class="n">server</span>
  <span class="n">Transaction</span> <span class="n">log</span>        <span class="o">-</span> <span class="mf">1.0</span> <span class="n">GB</span> <span class="n">free</span> <span class="n">on</span> <span class="n">most</span> <span class="n">full</span> <span class="n">server</span>

<span class="n">Workload</span><span class="p">:</span>
  <span class="n">Read</span> <span class="n">rate</span>              <span class="o">-</span> <span class="mi">2</span> <span class="n">Hz</span>
  <span class="n">Write</span> <span class="n">rate</span>             <span class="o">-</span> <span class="mi">0</span> <span class="n">Hz</span>
  <span class="n">Transactions</span> <span class="n">started</span>   <span class="o">-</span> <span class="mi">2</span> <span class="n">Hz</span>
  <span class="n">Transactions</span> <span class="n">committed</span> <span class="o">-</span> <span class="mi">0</span> <span class="n">Hz</span>
  <span class="n">Conflict</span> <span class="n">rate</span>          <span class="o">-</span> <span class="mi">0</span> <span class="n">Hz</span>

<span class="n">Backup</span> <span class="ow">and</span> <span class="n">DR</span><span class="p">:</span>
  <span class="n">Running</span> <span class="n">backups</span>        <span class="o">-</span> <span class="mi">0</span>
  <span class="n">Running</span> <span class="n">DRs</span>            <span class="o">-</span> <span class="mi">0</span>

<span class="n">Process</span> <span class="n">performance</span> <span class="n">details</span><span class="p">:</span>
  <span class="mf">10.0</span><span class="o">.</span><span class="mf">4.1</span><span class="p">:</span><span class="mi">4500</span>       <span class="p">(</span> <span class="mi">3</span><span class="o">%</span> <span class="n">cpu</span><span class="p">;</span>  <span class="mi">2</span><span class="o">%</span> <span class="n">machine</span><span class="p">;</span> <span class="mf">0.004</span> <span class="n">Gbps</span><span class="p">;</span>  <span class="mi">0</span><span class="o">%</span> <span class="n">disk</span><span class="p">;</span> <span class="mf">2.5</span> <span class="n">GB</span> <span class="o">/</span> <span class="mf">4.1</span> <span class="n">GB</span> <span class="n">RAM</span>  <span class="p">)</span>
  <span class="mf">10.0</span><span class="o">.</span><span class="mf">4.2</span><span class="p">:</span><span class="mi">4500</span>       <span class="p">(</span> <span class="mi">1</span><span class="o">%</span> <span class="n">cpu</span><span class="p">;</span>  <span class="mi">2</span><span class="o">%</span> <span class="n">machine</span><span class="p">;</span> <span class="mf">0.004</span> <span class="n">Gbps</span><span class="p">;</span>  <span class="mi">0</span><span class="o">%</span> <span class="n">disk</span><span class="p">;</span> <span class="mf">2.5</span> <span class="n">GB</span> <span class="o">/</span> <span class="mf">4.1</span> <span class="n">GB</span> <span class="n">RAM</span>  <span class="p">)</span>
  <span class="mf">10.0</span><span class="o">.</span><span class="mf">4.3</span><span class="p">:</span><span class="mi">4500</span>       <span class="p">(</span> <span class="mi">1</span><span class="o">%</span> <span class="n">cpu</span><span class="p">;</span>  <span class="mi">2</span><span class="o">%</span> <span class="n">machine</span><span class="p">;</span> <span class="mf">0.004</span> <span class="n">Gbps</span><span class="p">;</span>  <span class="mi">0</span><span class="o">%</span> <span class="n">disk</span><span class="p">;</span> <span class="mf">2.5</span> <span class="n">GB</span> <span class="o">/</span> <span class="mf">4.1</span> <span class="n">GB</span> <span class="n">RAM</span>  <span class="p">)</span>

<span class="n">Coordination</span> <span class="n">servers</span><span class="p">:</span>
  <span class="mf">10.0</span><span class="o">.</span><span class="mf">4.1</span><span class="p">:</span><span class="mi">4500</span>
  <span class="mf">10.0</span><span class="o">.</span><span class="mf">4.2</span><span class="p">:</span><span class="mi">4500</span>
  <span class="mf">10.0</span><span class="o">.</span><span class="mf">4.3</span><span class="p">:</span><span class="mi">4500</span>

<span class="n">Client</span> <span class="n">time</span><span class="p">:</span> <span class="n">Thu</span> <span class="n">Mar</span> <span class="mi">15</span> <span class="mi">14</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">34</span> <span class="mi">2018</span>
</pre></div>
</div>
<p>The list of coordinators verifies that the coordinator change succeeded. A few things might cause this process to not go smoothly:</p>
<ul class="simple">
<li>If any of the new coordination servers fail before you run the <code class="docutils literal"><span class="pre">coordinators</span></code> command, the change will not occur, and the database will continue to use the old coordinators.</li>
<li>If a majority of the new coordination servers fail during or after the change, the database will not be available until a majority of them are available again.</li>
<li>If a majority of the old coordination servers fail before the change is completed, the database will be unavailable until a majority of them are available again. Consequently, the <code class="docutils literal"><span class="pre">coordinators</span></code> command cannot be used to repair a database which is unavailable because its coordinators are down.</li>
</ul>
<p>Once the change is complete, database servers and clients need to communicate with the old coordinators in order to update their cluster file to point to the new coordinators. (Each database server and client will physically re-write their cluster file to reference the new coordinators.) In most cases this process occurs automatically within a matter of seconds.</p>
<p>If some servers or clients are unable to write to their cluster file or are disconnected during the change of coordinators (and too many of the old coordinators become unavailable before they come back up), an administrator will need to manually copy the new cluster file to each affected machine and restart the database server or client, as if adding a new server or client to the cluster.</p>
<p>The <code class="docutils literal"><span class="pre">coordinators</span></code> command also supports a convenience option, <code class="docutils literal"><span class="pre">coordinators</span> <span class="pre">auto</span></code>, that automatically selects a set of coordination servers appropriate for the redundancy mode:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>user@host1$ fdbcli
Using cluster file `/etc/foundationdb/fdb.cluster&#39;.

The database is available.

Welcome to the fdbcli. For help, type `help&#39;.
fdb&gt; coordinators auto
Coordinators changed
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">coordinators</span> <span class="pre">auto</span></code> will not make any changes if the current coordinators are all available and support the current redundancy level.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal"><span class="pre">coordinators</span> <span class="pre">auto</span></code> selects processes based on IP address. If your cluster has processes on the same machine with different IP addresses, <code class="docutils literal"><span class="pre">coordinators</span> <span class="pre">auto</span></code> may select a set of coordinators that are not fault tolerant. To ensure maximal fault tolerance, we recommend selecting coordinators according to the criteria in <a class="reference internal" href="#configuration-choosing-coordination-servers"><span class="std std-ref">Choosing coordination servers</span></a> and setting them manually.</p>
</div>
</div>
<div class="section" id="changing-the-cluster-description">
<span id="configuration-setting-cluster-description"></span><h2>Changing the cluster description</h2>
<p>A cluster is named by the <code class="docutils literal"><span class="pre">description</span></code> field recorded in the <code class="docutils literal"><span class="pre">fdb.cluster</span></code> file (see <a class="reference internal" href="administration.html#cluster-file-format"><span class="std std-ref">Cluster file format</span></a>). For convenience of reference, you may want to change the <code class="docutils literal"><span class="pre">description</span></code> if you operate more than one cluster on the same machines. (Each cluster must be uniquely identified by the combination of <code class="docutils literal"><span class="pre">description</span></code> and <code class="docutils literal"><span class="pre">ID</span></code>.)</p>
<p>You can change the <code class="docutils literal"><span class="pre">description</span></code> using the <code class="docutils literal"><span class="pre">coordinators</span></code> command within <code class="docutils literal"><span class="pre">fdbcli</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">fdb</span><span class="o">&gt;</span> <span class="n">coordinators</span> <span class="n">description</span><span class="o">=</span><span class="n">cluster_b</span>
<span class="n">Coordination</span> <span class="n">state</span> <span class="n">changed</span>
</pre></div>
</div>
<p>You can also combine a change of <code class="docutils literal"><span class="pre">description</span></code> with <a class="reference internal" href="#configuration-changing-coordination-servers"><span class="std std-ref">changing coordinators</span></a>, whether by listing the coordinators or with <code class="docutils literal"><span class="pre">coordinators</span> <span class="pre">auto</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">fdb</span><span class="o">&gt;</span> <span class="n">coordinators</span> <span class="n">auto</span> <span class="n">description</span><span class="o">=</span><span class="n">cluster_c</span>
<span class="n">Coordination</span> <span class="n">state</span> <span class="n">changed</span>
</pre></div>
</div>
</div>
<div class="section" id="the-configuration-file">
<span id="foundationdb-conf"></span><h2>The configuration file</h2>
<p>The <code class="docutils literal"><span class="pre">fdbserver</span></code> server process is run and monitored on each server by the <code class="docutils literal"><span class="pre">fdbmonitor</span></code> <a class="reference internal" href="administration.html#administration-fdbmonitor"><span class="std std-ref">daemon</span></a>. <code class="docutils literal"><span class="pre">fdbmonitor</span></code> and <code class="docutils literal"><span class="pre">fdbserver</span></code> itself are controlled by the <code class="docutils literal"><span class="pre">foundationdb.conf</span></code> file located at:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">/etc/foundationdb/foundationdb.conf</span></code> on Linux</li>
<li><code class="docutils literal"><span class="pre">/usr/local/etc/foundationdb/foundationdb.conf</span></code> on macOS</li>
</ul>
<p>The <code class="docutils literal"><span class="pre">foundationdb.conf</span></code> file contains several sections, detailed below. Note that the presence of individual <code class="docutils literal"><span class="pre">[fdbserver.&lt;ID&gt;]</span></code> sections actually cause <code class="docutils literal"><span class="pre">fdbserver</span></code> processes to be run.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Whenever the <code class="docutils literal"><span class="pre">foundationdb.conf</span></code> file changes, the <code class="docutils literal"><span class="pre">fdbmonitor</span></code> daemon automatically detects the changes and starts, stops, or restarts child processes as necessary.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Do not attempt to stop FoundationDB services by removing the configuration file. Removing the file will not stop the services; it will merely remove your ability to control them in the manner supported by FoundationDB. During normal operation, services can be stopped by commenting out or removing the relevant sections of the configuration file. You can also disable a service at the operating system level or by removing the software.</p>
</div>
<div class="section" id="fdbmonitor-section">
<h3><code class="docutils literal"><span class="pre">[fdbmonitor]</span></code> section</h3>
<div class="highlight-ini"><div class="highlight"><pre><span></span><span class="c1">## foundationdb.conf</span>
<span class="c1">##</span>
<span class="c1">## Configuration file for FoundationDB server processes</span>
<span class="c1">## Full documentation is available in the FoundationDB Administration document.</span>

<span class="k">[fdbmonitor]</span>
<span class="na">restart_delay</span> <span class="o">=</span> <span class="s">60</span>
<span class="na">user</span> <span class="o">=</span> <span class="s">foundationdb</span>
<span class="na">group</span> <span class="o">=</span> <span class="s">foundationdb</span>
</pre></div>
</div>
<p>Contains basic configuration parameters of the <code class="docutils literal"><span class="pre">fdbmonitor</span></code> process. <code class="docutils literal"><span class="pre">restart_delay</span></code> specifies the number of seconds that <code class="docutils literal"><span class="pre">fdbmonitor</span></code> waits before restarting a failed process. <code class="docutils literal"><span class="pre">user</span></code> and <code class="docutils literal"><span class="pre">group</span></code> are used on Linux systems to control the privilege level of child processes.</p>
</div>
<div class="section" id="general-section">
<h3><code class="docutils literal"><span class="pre">[general]</span></code> section</h3>
<div class="highlight-ini"><div class="highlight"><pre><span></span><span class="k">[general]</span>
<span class="na">cluster_file</span> <span class="o">=</span> <span class="s">/etc/foundationdb/fdb.cluster</span>
</pre></div>
</div>
<p>Contains settings applicable to all processes (e.g. fdbserver, backup_agent). The main setting of interest is <code class="docutils literal"><span class="pre">cluster_file</span></code>, which specifies the location of the cluster file. This file and the directory that contains it must be writable by all processes (i.e. by the user or group set in the [fdbmonitor] section).</p>
</div>
<div class="section" id="fdbserver-section">
<span id="foundationdb-conf-fdbserver"></span><h3><code class="docutils literal"><span class="pre">[fdbserver]</span></code> section</h3>
<div class="highlight-ini"><div class="highlight"><pre><span></span><span class="c1">## Default parameters for individual fdbserver processes</span>
<span class="k">[fdbserver]</span>
<span class="na">command</span> <span class="o">=</span> <span class="s">/usr/sbin/fdbserver</span>
<span class="na">public_address</span> <span class="o">=</span> <span class="s">auto:$ID</span>
<span class="na">listen_address</span> <span class="o">=</span> <span class="s">public</span>
<span class="na">datadir</span> <span class="o">=</span> <span class="s">/var/lib/foundationdb/data/$ID</span>
<span class="na">logdir</span> <span class="o">=</span> <span class="s">/var/log/foundationdb</span>
<span class="c1"># logsize = 10MiB</span>
<span class="c1"># maxlogssize = 100MiB</span>
<span class="c1"># class =</span>
<span class="c1"># memory = 8GiB</span>
<span class="c1"># storage_memory = 1GiB</span>
<span class="c1"># locality_machineid =</span>
<span class="c1"># locality_zoneid =</span>
<span class="c1"># locality_data_hall =</span>
<span class="c1"># locality_dcid =</span>
<span class="c1"># io_trust_seconds = 20</span>
</pre></div>
</div>
<p>Contains default parameters for all fdbserver processes on this machine. These same options can be overridden for individual processes in their respective <code class="docutils literal"><span class="pre">[fdbserver.&lt;ID&gt;]</span></code> sections. In this section, the ID of the individual fdbserver can be substituted by using the <code class="docutils literal"><span class="pre">$ID</span></code> variable in the value. For example, <code class="docutils literal"><span class="pre">public_address</span> <span class="pre">=</span> <span class="pre">auto:$ID</span></code> makes each fdbserver listen on a port equal to its ID.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Sizes must be specified as a number of bytes followed by one of the multiplicative suffixes B=1, KB=10<sup>3</sup>, KiB=2<sup>10</sup>, MB=10<sup>6</sup>, MiB=2<sup>20</sup>, GB=10<sup>9</sup>, GiB=2<sup>30</sup>, TB=10<sup>12</sup>, or TiB=2<sup>40</sup>.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In general locality id&#8217;s are used to specify the location of processes which in turn is used to determine fault and replication domains.</p>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">command</span></code>: The location of the <code class="docutils literal"><span class="pre">fdbserver</span></code> binary.</li>
<li><code class="docutils literal"><span class="pre">public_address</span></code>: The publicly visible IP:Port of the process. If <code class="docutils literal"><span class="pre">auto</span></code>, the address will be the one used to communicate with the coordination servers.</li>
<li><code class="docutils literal"><span class="pre">listen_address</span></code>: The IP:Port that the server socket should bind to. If <code class="docutils literal"><span class="pre">public</span></code>, it will be the same as the public_address.</li>
<li><code class="docutils literal"><span class="pre">datadir</span></code>: A writable directory (by root or by the user set in the [fdbmonitor] section) where persistent data files will be stored.</li>
<li><code class="docutils literal"><span class="pre">logdir</span></code>: A writable directory (by root or by the user set in the [fdbmonitor] section) where FoundationDB will store log files.</li>
<li><code class="docutils literal"><span class="pre">logsize</span></code>: Roll over to a new log file after the current log file reaches the specified size. The default value is 10MiB.</li>
<li><code class="docutils literal"><span class="pre">maxlogssize</span></code>: Delete the oldest log file when the total size of all log files exceeds the specified size. If set to 0B, old log files will not be deleted. The default value is 100MiB.</li>
<li><code class="docutils literal"><span class="pre">class</span></code>: Process class specifying the roles that will be taken in the cluster. Recommended options are <code class="docutils literal"><span class="pre">storage</span></code>, <code class="docutils literal"><span class="pre">transaction</span></code>, <code class="docutils literal"><span class="pre">stateless</span></code>. See <a class="reference internal" href="#guidelines-process-class-config"><span class="std std-ref">Guidelines for setting process class</span></a> for process class config recommendations.</li>
<li><code class="docutils literal"><span class="pre">memory</span></code>: Maximum memory used by the process. The default value is 8GiB. When specified without a unit, MiB is assumed. This parameter does not change the memory allocation of the program. Rather, it sets a hard limit beyond which the process will kill itself and be restarted. The default value of 8GiB is double the intended memory usage in the default configuration (providing an emergency buffer to deal with memory leaks or similar problems). It is <em>not</em> recommended to decrease the value of this parameter below its default value. It may be <em>increased</em> if you wish to allocate a very large amount of storage engine memory or cache. In particular, when the <code class="docutils literal"><span class="pre">storage_memory</span></code> parameter is increased, the <code class="docutils literal"><span class="pre">memory</span></code> parameter should be increased by an equal amount.</li>
<li><code class="docutils literal"><span class="pre">storage_memory</span></code>: Maximum memory used for data storage. This paramenter is used <em>only</em> with memory storage engine, not the ssd storage engine. The default value is 1GiB. When specified without a unit, MB is assumed. Clusters will be restricted to using this amount of memory per process for purposes of data storage. Memory overhead associated with storing the data is counted against this total. If you increase the <code class="docutils literal"><span class="pre">storage_memory</span></code>, you should also increase the <code class="docutils literal"><span class="pre">memory</span></code> parameter by the same amount.</li>
<li><code class="docutils literal"><span class="pre">locality_machineid</span></code>: Machine identifier key. All processes on a machine should share a unique id. By default, processes on a machine determine a unique id to share. This does not generally need to be set.</li>
<li><code class="docutils literal"><span class="pre">locality_zoneid</span></code>: Zone identifier key.  Processes that share a zone id are considered non-unique for the purposes of data replication. If unset, defaults to machine id.</li>
<li><code class="docutils literal"><span class="pre">locality_dcid</span></code>: Data center identifier key. All processes physically located in a data center should share the id. No default value. If you are depending on data center based replication this must be set on all processes.</li>
<li><code class="docutils literal"><span class="pre">locality_data_hall</span></code>: Data hall identifier key. All processes physically located in a data hall should share the id. No default value. If you are depending on data hall based replication this must be set on all processes.</li>
<li><code class="docutils literal"><span class="pre">io_trust_seconds</span></code>: Time in seconds that a read or write operation is allowed to take before timing out with an error. If an operation times out, all future operations on that file will fail with an error as well. Only has an effect when using AsyncFileKAIO in Linux. If unset, defaults to 0 which means timeout is disabled.</li>
</ul>
</div>
<div class="section" id="fdbserver-id-section-s">
<h3><code class="docutils literal"><span class="pre">[fdbserver.&lt;ID&gt;]</span></code> section(s)</h3>
<div class="highlight-ini"><div class="highlight"><pre><span></span><span class="c1">## An individual fdbserver process with id 4500</span>
<span class="c1">## Parameters set here override defaults from the [fdbserver] section</span>
<span class="k">[fdbserver.4500]</span>
</pre></div>
</div>
<p>Each section of this type represents an <code class="docutils literal"><span class="pre">fdbserver</span></code> process that will be run. IDs cannot be repeated. Frequently, an administrator will choose to run one <code class="docutils literal"><span class="pre">fdbserver</span></code> per CPU core. Parameters set in this section apply to only a single fdbserver process, and overwrite the defaults set in the <code class="docutils literal"><span class="pre">[fdbserver]</span></code> section. Note that by default, the ID specified in this section is also used as the network port and the data directory.</p>
</div>
<div class="section" id="backup-agent-sections">
<h3>Backup agent sections</h3>
<div class="highlight-ini"><div class="highlight"><pre><span></span><span class="k">[backup_agent]</span>
<span class="na">command</span> <span class="o">=</span> <span class="s">/usr/lib/foundationdb/backup_agent/backup_agent</span>

<span class="k">[backup_agent.1]</span>
</pre></div>
</div>
<p>These sections run and configure the backup agent process used for <a class="reference internal" href="backups.html"><span class="doc">point-in-time backups</span></a> of FoundationDB. These don&#8217;t usually need to be modified. The structure and functionality is similar to the <code class="docutils literal"><span class="pre">[fdbserver]</span></code> and <code class="docutils literal"><span class="pre">[fdbserver.&lt;ID&gt;]</span></code> sections.</p>
</div>
</div>
<div class="section" id="choosing-a-redundancy-mode">
<span id="configuration-choosing-redundancy-mode"></span><h2>Choosing a redundancy mode</h2>
<p>FoundationDB supports a variety of redundancy modes. These modes define storage requirements, required cluster size, and resilience to failure. To change the redundancy mode, use the <code class="docutils literal"><span class="pre">configure</span></code> command <code class="docutils literal"><span class="pre">fdbcli</span></code>. For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>user@host$ fdbcli
Using cluster file `/etc/foundationdb/fdb.cluster&#39;.

The database is available.

Welcome to the fdbcli. For help, type `help&#39;.
fdb&gt; configure double
Configuration changed.
</pre></div>
</div>
<p>The available redundancy modes are described below.</p>
<div class="section" id="single-datacenter-modes">
<h3>Single datacenter modes</h3>
<table border="1" class="docutils">
<colgroup>
<col width="37%" />
<col width="2%" />
<col width="21%" />
<col width="21%" />
<col width="20%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">&#160;</th>
<th class="head">&#160;</th>
<th class="head">single</th>
<th class="head">double</th>
<th class="head">triple</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Best for</td>
<td>&#160;</td>
<td>1-2 machines</td>
<td>3-4 machines</td>
<td>5+ machines</td>
</tr>
<tr class="row-odd"><td>Replication</td>
<td>&#160;</td>
<td>1 copy</td>
<td>2 copy</td>
<td>3 copy</td>
</tr>
<tr class="row-even"><td># live machines
to make progress</td>
<td>&#160;</td>
<td>1</td>
<td>2</td>
<td>3</td>
</tr>
<tr class="row-odd"><td>Minimum # of machines
for fault tolerance</td>
<td>&#160;</td>
<td>impossible</td>
<td>3</td>
<td>4</td>
</tr>
<tr class="row-even"><td>Ideal # of
coordination servers</td>
<td>&#160;</td>
<td>1</td>
<td>3</td>
<td>5</td>
</tr>
<tr class="row-odd"><td># simultaneous failures
after which data may be lost</td>
<td>&#160;</td>
<td>any machine</td>
<td>2+ machines</td>
<td>3+ machines</td>
</tr>
</tbody>
</table>
<p>In the three single datacenter redundancy modes, FoundationDB replicates data across the required number of machines in the cluster, but without aiming for datacenter redundancy. Although machines may be placed in more than one datacenter, the cluster will not be tolerant of datacenter-correlated failures.</p>
<p>FoundationDB will never use processes on the same machine for the replication of any single piece of data. For this reason, references to the number of &#8220;machines&#8221; in the summary table above are the number of physical machines, not the number of <code class="docutils literal"><span class="pre">fdbserver</span></code> processes.</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">single</span></code> mode</dt>
<dd><p class="first"><em>(best for 1-2 machines)</em></p>
<p class="last">FoundationDB does not replicate data and needs only one physical machine to make progress. Because data is not replicated, the database is not fault-tolerant. This mode is recommended for testing on a single development machine. (<code class="docutils literal"><span class="pre">single</span></code> mode <em>will</em> work with clusters of two or more computers and will partition data for increased performance but the cluster will not tolerate the loss of any machines.)</p>
</dd>
<dt><code class="docutils literal"><span class="pre">double</span></code> mode</dt>
<dd><p class="first"><em>(best for 3-4 machines)</em></p>
<p>FoundationDB replicates data to two machines, so two or more machines are required to make progress. The loss of one machine can be survived without losing data, but if only two machines were present originally, the database will be unavailable until the second machine is restored, another machine is added, or the replication mode is changed.</p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In double redundancy mode, we recommend using three coordinators. In a two machine double redundancy cluster without a third coordinator, the coordination state has no redundancy.  Losing either machine will make the database unavailable, and recoverable only by an unsafe manual recovery of the coordination state.</p>
</div>
</dd>
</dl>
<dl class="docutils" id="configuration-redundancy-mode-triple">
<dt><code class="docutils literal"><span class="pre">triple</span></code> mode</dt>
<dd><p class="first"><em>(best for 5+ machines)</em></p>
<p class="last">FoundationDB replicates data to three machines, and at least three available machines are required to make progress. This is the recommended mode for a cluster of five or more machines in a single datacenter.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">three_data_hall</span></code> mode</dt>
<dd>FoundationDB replicates data to three machines, and at least three available machines are required to make progress. Every piece of data that has been committed to storage servers
will be replicated onto three different data halls, and the cluster will
remain available after losing a single data hall and one machine in another
data hall.</dd>
</dl>
</div>
<div class="section" id="datacenter-aware-mode">
<h3>Datacenter-aware mode</h3>
<p>In addition to the more commonly used modes listed above, this version of FoundationDB has support for redundancy across multiple datacenters. Although data will always be triple replicated in this mode, it may not be replicated across all datacenters.</p>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When using the datacenter-aware mode, all <code class="docutils literal"><span class="pre">fdbserver</span></code> processes should be passed a valid datacenter identifier on the command line.</p>
</div>
</div></blockquote>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">three_datacenter</span></code> mode</dt>
<dd><p class="first"><em>(for 5+ machines in 3 datacenters)</em></p>
<p class="last">FoundationDB attempts to replicate data across two datacenters and will stay up with only two available. Data is triple replicated.  For maximum availability, you should use five coordination servers: two in two of the datacenters and one in the third datacenter.</p>
</dd>
</dl>
</div>
<div class="section" id="changing-redundancy-mode">
<h3>Changing redundancy mode</h3>
<p>You can change the redundancy mode of a database at any time using <code class="docutils literal"><span class="pre">fdbcli</span></code>. For example, after adding more machines to a cluster that was initially configured in <code class="docutils literal"><span class="pre">single</span></code> mode, you might increase the redundancy mode to <code class="docutils literal"><span class="pre">triple</span></code>. After the change, FoundationDB will replicate your data accordingly (and remain available while it does so).</p>
<p>If a database is unavailable because it has too few machines to function in its current redundancy mode, you can restore it to operation by changing the redundancy mode to one with lower requirements. For example, if a database configured in <code class="docutils literal"><span class="pre">triple</span></code> mode in a 4 server cluster loses two servers, it will stop operating because the configured redundancy is unachievable. It will start working immediately if you configure it to <code class="docutils literal"><span class="pre">double</span></code> mode. Consider the consequences of reducing the redundancy level carefully before doing so. If you reduce or eliminate redundancy and there are further hardware failures, your data could be lost permanently. The best option, if available, is to add new hardware to the cluster to restore it to its minimum operating size.</p>
<p>Similarly, if you change the redundancy mode to a mode that cannot make progress with currently available hardware (for example, to <code class="docutils literal"><span class="pre">triple</span></code> when there are only two machines available), the database will immediately become unavailable. Changing the mode back or adding the necessary machines to the cluster will restore it to operation.</p>
</div>
</div>
<div class="section" id="configuring-the-storage-subsystem">
<span id="configuration-configuring-storage-subsystem"></span><h2>Configuring the storage subsystem</h2>
<div class="section" id="storage-engines">
<span id="configuration-storage-engine"></span><h3>Storage engines</h3>
<p>A storage engine is the part of the database that is responsible for storing data to disk. FoundationDB has two storage engines options, <code class="docutils literal"><span class="pre">ssd</span></code> and <code class="docutils literal"><span class="pre">memory</span></code>.</p>
<p>For both storage engines, FoundationDB commits transactions to disk with the number of copies indicated by the redundancy mode before reporting them committed. This procedure guarantees the <em>durability</em> needed for full ACID compliance. At the point of the commit, FoundationDB may have only <em>logged</em> the transaction, deferring the work of updating the disk representation. This deferral has significant advantages for latency and burst performance. Due to this deferral, it is possible for disk space usage to continue increasing after the last commit.</p>
<p>To change the storage engine, use the <code class="docutils literal"><span class="pre">configure</span></code> command of <code class="docutils literal"><span class="pre">fdbcli</span></code>. For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>user@host$ fdbcli
Using cluster file `/etc/foundationdb/fdb.cluster&#39;.

The database is available.

Welcome to the fdbcli. For help, type `help&#39;.
fdb&gt; configure ssd
Configuration changed.
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <a class="reference internal" href="administration.html#storage-space-requirements"><span class="std std-ref">storage space requirements</span></a> of each storage engine are discussed in the Administration Guide.</p>
</div>
<dl class="docutils" id="configuration-storage-engine-ssd">
<dt><code class="docutils literal"><span class="pre">ssd</span></code> storage engine</dt>
<dd><p class="first"><em>(optimized for SSD storage)</em></p>
<p>Data is stored on disk in B-tree data structures optimized for use on <a class="reference internal" href="#ssd-info"><span class="std std-ref">SSDs</span></a>. This engine is more robust when the right disk hardware is available, as it can store large amounts of data.</p>
<p>The <code class="docutils literal"><span class="pre">ssd</span></code> engine recovers storage space on a deferred basis after data is deleted from the database. Following a deletion, the engine slowly shuffles empty B-tree pages to the end of the database file and truncates them. This activity is given a low priority relative to normal database operations, so there may be a delay before the database reaches minimum size.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <code class="docutils literal"><span class="pre">ssd</span></code> storage engine can be slow to return space from deleted data to the filesystem when the number of free pages is very large. This condition can arise when you have deleted most of the data in your database or greatly increased the number of processes in your cluster. In this condition, the database is still able to reuse the space, but the disk files may remain large for an extended period.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Because the database is able to reuse the space, action is required only if your application requires the space for some non-database purpose. In this case, you can reclaim space by <a class="reference internal" href="administration.html#removing-machines-from-a-cluster"><span class="std std-ref">excluding affected server processes</span></a> (either singly or a few at a time) and then including them again. Excluding removes the storage server and its data files completely, and when the server is included again, it uses a fresh database file.</p>
</div>
<p class="last">Because this engine is tuned for SSDs, it may have poor performance or even availability problems when run on weaker I/O subsystems such as spinning disks or network attached storage.</p>
</dd>
</dl>
<dl class="docutils" id="configuration-storage-engine-memory">
<dt><code class="docutils literal"><span class="pre">memory</span></code> storage engine</dt>
<dd><p class="first"><em>(optimized for small databases)</em></p>
<p>Data is stored in memory and logged to disk. In this storage engine, all data must be resident in memory at all times, and all reads are satisfied from memory. Additionally, all writes are saved to disk to ensure that data is always fully durable. This engine works well with storage subsystems, such as spinning disks, that have good sequential write performance but poor random I/O performance.</p>
<p>By default, each process using the memory storage engine is limited to storing 1 GB of data (including overhead). This limit can be changed using the <code class="docutils literal"><span class="pre">storage_memory</span></code> parameter as documented in <a class="reference internal" href="#foundationdb-conf"><span class="std std-ref">foundationdb.conf</span></a>.</p>
<p class="last">When using the <code class="docutils literal"><span class="pre">memory</span></code> engine, especially with a larger memory limit, it can take some time (seconds to minutes) for a storage machine to start up. This is because it needs to reconstruct its in-memory data structure from the logs stored on disk.</p>
</dd>
</dl>
</div>
<div class="section" id="storage-locations">
<h3>Storage locations</h3>
<p>Each FoundationDB process stores its state in a subdirectory of the directory supplied to it by the <code class="docutils literal"><span class="pre">datadir</span></code> configuration parameter in the <a class="reference internal" href="#foundationdb-conf"><span class="std std-ref">configuration file</span></a>. By default this directory is:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">/var/lib/foundationdb/data/&lt;port&gt;</span></code> on Linux.</li>
<li><code class="docutils literal"><span class="pre">/usr/local/foundationdb/data/&lt;port&gt;</span></code> on macOS.</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">You must always use different <code class="docutils literal"><span class="pre">datadir</span></code> settings for different processes!</p>
</div>
<p>To use multiple disks for performance and capacity improvements, configure the <code class="docutils literal"><span class="pre">datadir</span></code> of individual <code class="docutils literal"><span class="pre">fdbserver</span></code> processes to point to different disks, as follows:</p>
<ol class="arabic">
<li><p class="first"><a class="reference internal" href="administration.html#administration-running-foundationdb"><span class="std std-ref">Stop</span></a> the FoundationDB server processes on a machine.</p>
</li>
<li><p class="first">Transfer the contents of the state subdirectories to new directories on the desired disks, and make sure the directories are writable by the <code class="docutils literal"><span class="pre">fdbserver</span></code>.</p>
</li>
<li><p class="first">Edit <a class="reference internal" href="#foundationdb-conf"><span class="std std-ref">foundationdb.conf</span></a> to reference the new directories. For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">fdbserver</span><span class="o">.</span><span class="mi">4500</span><span class="p">]</span>
<span class="n">datadir</span><span class="o">=/</span><span class="n">ssd1</span><span class="o">/</span><span class="n">foundationdb</span><span class="o">/</span><span class="mi">4500</span>

<span class="p">[</span><span class="n">fdbserver</span><span class="o">.</span><span class="mi">4501</span><span class="p">]</span>
<span class="n">datadir</span><span class="o">=/</span><span class="n">ssd2</span><span class="o">/</span><span class="n">foundationdb</span><span class="o">/</span><span class="mi">4501</span>
</pre></div>
</div>
</li>
<li><p class="first"><a class="reference internal" href="administration.html#administration-running-foundationdb"><span class="std std-ref">Start</span></a> the FoundationDB server</p>
</li>
</ol>
</div>
<div class="section" id="ssd-considerations">
<span id="ssd-info"></span><h3>SSD considerations</h3>
<p>FoundationDB is designed to work with SSDs (solid state drives). SSD performance is both highly variable and hard to get good data on from public sources. Since OS configuration, controller, firmware, and driver can each have a large impact on performance (up to an order of magnitude), drives should be tested to make sure the advertised performance characteristics are being achieved. Tests should be conducted with the same load profile as FoundationDB, which typically creates a workload of mixed small reads and writes at a high queue depth.</p>
<p>SSDs are unlike HDDs in that they fail after a certain amount of wear. FoundationDB will use all of the SSDs in the cluster at approximately the same rate. Therefore, if a cluster is started on brand new SSDs, all of them will fail due to wear at approximately the same time. To prevent this occurrence, rotate new drives into the cluster on a continuous basis and monitor their S.M.A.R.T. attributes to check wear levels.</p>
</div>
<div class="section" id="filesystem">
<h3>Filesystem</h3>
<p>FoundationDB recommends the ext4 filesystem. (However, see <a class="reference internal" href="platforms.html#platform-ubuntu-12"><span class="std std-ref">Platform Issues for Ubuntu 12.x</span></a> for an issue relating to ext4 on that platform.)</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<ul class="last simple">
<li>FoundationDB requires filesystem support for kernel asynchronous I/O.</li>
<li>Older filesystems such as ext3 lack important features for operating safely and efficiently with an SSD.</li>
<li>Copy-on-write type filesystems (such as Btrfs) will likely have poor performance with FoundationDB.</li>
</ul>
</div>
<p>Ext4 filesystems should be mounted with mount options <code class="docutils literal"><span class="pre">default,noatime,discard</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <code class="docutils literal"><span class="pre">noatime</span></code> option disables updating of access times when reading files, an unneeded feature for FoundationDB that increases write activity on the disk. The discard option enables <a class="reference external" href="http://en.wikipedia.org/wiki/TRIM">TRIM</a> support, allowing the operating system to efficiently inform the SSD of erased blocks, maintaining high write speed and increasing drive lifetime.</p>
</div>
</div>
<div class="section" id="durability-and-caching">
<h3>Durability and caching</h3>
<p>FoundationDB relies on the correct operation of <code class="docutils literal"><span class="pre">fsync()</span></code> to ensure the durability of transactions in the event of power failures. The combination of the file system, mount options, hard disk controller, and hard disk all need to work together properly to ensure that the operating system is correct when it reports to FoundationDB that data is safely stored.</p>
<p>If you are unsure about your hardware setup and need to ensure that data durability is maintained in all possible situations, we recommend that you test your hardware.</p>
</div>
<div class="section" id="disk-partitioning">
<h3>Disk partitioning</h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Modern Linux distributions already adhere to the suggestions below for newly formatted disks. If your system is recently installed this section can be skipped.</p>
</div>
<p>For performance reasons, it is critical that partitions on SSDs in Linux be aligned with the Erase Block Size (EBS) of the drive. The value of the EBS is vendor specific, but a value of 1024 KiB is both greater than or equal to and a multiple of any current EBS, so is safe to use with any SSD. (Defaulting to 1024 KiB is how Windows 7 and recent Linux distributions guarantee efficient SSD operation.)
To verify that the start of the partition is aligned with the EBS of the drive use the <code class="docutils literal"><span class="pre">fdisk</span></code> utility:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>user@host$ sudo fdisk -l /dev/sdb

Disk /dev/sdb: 128.0 GB, 128035676160 bytes
30 heads, 63 sectors/track, 132312 cylinders, total 250069680 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk identifier: 0xe5169faa

   Device Boot     Start         End      Blocks   Id  System
     /dev/sdb1      2048   250069679   125033816   83  Linux
</pre></div>
</div>
<p>This output shows a properly partitioned disk in Ubuntu 12.04.</p>
<p>When creating a partition for use with FoundationDB using the standard Linux fdisk utility, DOS compatibility mode should be disabled (<code class="docutils literal"><span class="pre">c</span></code> command in interactive mode) and display units should be set to sectors (<code class="docutils literal"><span class="pre">u</span></code> command in interactive mode), rather than cylinders. Again, this is the default mode in recent Linux distributions but must be configured on older systems.</p>
<p>For an SSD with a single partition, the partition should typically begin at sector 2048 (512 byte sectors yields 1024 KiB alignment).</p>
</div>
</div>
<div class="section" id="guidelines-for-setting-process-class">
<span id="guidelines-process-class-config"></span><h2>Guidelines for setting process class</h2>
<p>In a FoundationDB cluster, each of the <code class="docutils literal"><span class="pre">fdbserver</span></code> processes perform different tasks. Each process is recruited to do a particular task based on its process <code class="docutils literal"><span class="pre">class</span></code>. For example, processes with <code class="docutils literal"><span class="pre">class=storage</span></code> are given preference to be recruited for doing storage server tasks, <code class="docutils literal"><span class="pre">class=transaction</span></code> are for log server processes and <code class="docutils literal"><span class="pre">class=stateless</span></code> are for stateless processes like proxies, resolvers, etc.,</p>
<p>The recommended minimum number of <code class="docutils literal"><span class="pre">class=transaction</span></code> (log server) processes is 8 (active) + 2 (standby) and the recommended minimum number for <code class="docutils literal"><span class="pre">class=stateless</span></code> processes is 4 (proxy) + 1 (resolver) + 1 (cluster controller) + 1 (master) + 2 (standby). It is better to spread the transaction and stateless processes across as many machines as possible.</p>
<p><code class="docutils literal"><span class="pre">fdbcli</span></code> is used to set the desired number of processes of a particular process type. To do so, you would issue the <code class="docutils literal"><span class="pre">fdbcli</span></code> commands:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">fdb</span><span class="o">&gt;</span> <span class="n">configure</span> <span class="n">proxies</span><span class="o">=</span><span class="mi">5</span>
<span class="n">fdb</span><span class="o">&gt;</span> <span class="n">configure</span> <span class="n">logs</span><span class="o">=</span><span class="mi">8</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In the present release, the default value for proxies and log servers is 3 and for resolvers is 1. You should not set the value of a process type to less than its default.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The conflict-resolution algorithm used by FoundationDB is conservative: it guarantees that no conflicting transactions will be committed, but it may fail to commit some transactions that theoretically could have been. The effects of this conservatism may increase as you increase the number of resolvers. It is therefore important to employ the recommended techniques for <a class="reference internal" href="developer-guide.html#developer-guide-transaction-conflicts"><span class="std std-ref">minimizing conflicts</span></a> when increasing the number of resolvers.</p>
</div>
<p>You can contact us on the <a class="reference external" href="https://forums.foundationdb.org">community forums</a> if you are interested in more details or if you are benchmarking or performance-tuning on large clusters. Also see our <a class="reference external" href="/performance">performance benchmarks</a> for a baseline of how a well-configured cluster should perform.</p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
<div id="sourcelink">
  <a href="_sources/configuration.rst.txt"
     rel="nofollow">Source</a>
</div>
      
    </p>
    <p>
        &copy; Copyright 2013-2018 Apple, Inc and the FoundationDB project authors.<br/>
      Last updated on Apr 18, 2018.<br/>
    </p>
  </div>
</footer>
  </body>
</html>