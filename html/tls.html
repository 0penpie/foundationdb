<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Transport Layer Security &#8212; FoundationDB 5.2</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-3.3.4/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-3.3.4/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '5.2.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.3.4/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Earlier Release Notes" href="earlier-release-notes.html" />
    <link rel="prev" title="Moving a Cluster to New Machines" href="moving-a-cluster.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          FoundationDB</a>
        <span class="navbar-text navbar-version pull-left"><b>5.2</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="contents.html">Site Map</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"></ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Transport Layer Security</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#setting-up-foundationdb-to-use-tls">Setting Up FoundationDB to use TLS</a><ul>
<li><a class="reference internal" href="#enabling-tls-in-a-new-cluster">Enabling TLS in a new cluster</a></li>
</ul>
</li>
<li><a class="reference internal" href="#converting-an-existing-cluster-to-use-tls">Converting an existing cluster to use TLS</a></li>
<li><a class="reference internal" href="#configuring-the-tls-plugin">Configuring the TLS Plugin</a><ul>
<li><a class="reference internal" href="#default-values">Default Values</a><ul>
<li><a class="reference internal" href="#plugin-default-location">Plugin default location</a></li>
<li><a class="reference internal" href="#certificate-file-default-location">Certificate file default location</a></li>
<li><a class="reference internal" href="#default-peer-verification">Default Peer Verification</a></li>
<li><a class="reference internal" href="#default-password">Default Password</a></li>
<li><a class="reference internal" href="#ca-file-default-location">CA file default location</a></li>
</ul>
</li>
<li><a class="reference internal" href="#parameters-and-client-bindings">Parameters and client bindings</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-default-libressl-based-plugin">The default LibreSSL-based plugin</a><ul>
<li><a class="reference internal" href="#formats">Formats</a></li>
<li><a class="reference internal" href="#required-files">Required files</a><ul>
<li><a class="reference internal" href="#the-certificate-file">The certificate file</a></li>
<li><a class="reference internal" href="#the-key-file">The key file</a></li>
</ul>
</li>
<li><a class="reference internal" href="#certificate-creation">Certificate creation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#peer-verification">Peer verification</a><ul>
<li><a class="reference internal" href="#certificate-field-verification">Certificate field verification</a><ul>
<li><a class="reference internal" href="#turning-down-the-validation">Turning down the validation</a></li>
<li><a class="reference internal" href="#adding-verification-requirements">Adding verification requirements</a></li>
<li><a class="reference internal" href="#verification-examples">Verification Examples</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="moving-a-cluster.html" title="Previous Chapter: Moving a Cluster to New Machines"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Moving a Clus...</span>
    </a>
  </li>
  <li>
    <a href="earlier-release-notes.html" title="Next Chapter: Earlier Release Notes"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Earlier Release Notes &raquo;</span>
    </a>
  </li>
              
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><ul>
<li><a class="reference internal" href="#">Transport Layer Security</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#setting-up-foundationdb-to-use-tls">Setting Up FoundationDB to use TLS</a><ul>
<li><a class="reference internal" href="#enabling-tls-in-a-new-cluster">Enabling TLS in a new cluster</a></li>
</ul>
</li>
<li><a class="reference internal" href="#converting-an-existing-cluster-to-use-tls">Converting an existing cluster to use TLS</a></li>
<li><a class="reference internal" href="#configuring-the-tls-plugin">Configuring the TLS Plugin</a><ul>
<li><a class="reference internal" href="#default-values">Default Values</a><ul>
<li><a class="reference internal" href="#plugin-default-location">Plugin default location</a></li>
<li><a class="reference internal" href="#certificate-file-default-location">Certificate file default location</a></li>
<li><a class="reference internal" href="#default-peer-verification">Default Peer Verification</a></li>
<li><a class="reference internal" href="#default-password">Default Password</a></li>
<li><a class="reference internal" href="#ca-file-default-location">CA file default location</a></li>
</ul>
</li>
<li><a class="reference internal" href="#parameters-and-client-bindings">Parameters and client bindings</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-default-libressl-based-plugin">The default LibreSSL-based plugin</a><ul>
<li><a class="reference internal" href="#formats">Formats</a></li>
<li><a class="reference internal" href="#required-files">Required files</a><ul>
<li><a class="reference internal" href="#the-certificate-file">The certificate file</a></li>
<li><a class="reference internal" href="#the-key-file">The key file</a></li>
</ul>
</li>
<li><a class="reference internal" href="#certificate-creation">Certificate creation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#peer-verification">Peer verification</a><ul>
<li><a class="reference internal" href="#certificate-field-verification">Certificate field verification</a><ul>
<li><a class="reference internal" href="#turning-down-the-validation">Turning down the validation</a></li>
<li><a class="reference internal" href="#adding-verification-requirements">Adding verification requirements</a></li>
<li><a class="reference internal" href="#verification-examples">Verification Examples</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    <div class="col-md-9 content">
      
  <div class="section" id="transport-layer-security">
<h1>Transport Layer Security</h1>
<div class="section" id="introduction">
<h2>Introduction</h2>
<p>Transport Layer Security (TLS) and its predecessor, Secure Sockets Layer (SSL), are protocols designed to provide communication security over public networks. Users exchange a symmetric session key that is used to encrypt data exchanged between the parties.</p>
<p>By default, a FoundationDB cluster uses <em>unencrypted</em> connections among client and server processes. This document describes the <a class="reference external" href="http://en.wikipedia.org/wiki/Transport_Layer_Security">Transport Layer Security</a> (TLS) capabilities of FoundationDB, which enable security and authentication through a public/private key infrastructure. TLS is provided in FoundationDB via a plugin-based architecture. This document will describe the basic TLS capabilities of FoundationDB and document the default plugin, which is based on <a class="reference external" href="https://www.libressl.org/">LibreSSL</a>. TLS-enabled servers will only communicate with other TLS-enabled servers and TLS-enabled clients. Therefore, a cluster&#8217;s machines must all enable TLS in order for TLS to be used.</p>
</div>
<div class="section" id="setting-up-foundationdb-to-use-tls">
<h2>Setting Up FoundationDB to use TLS</h2>
<div class="section" id="enabling-tls-in-a-new-cluster">
<span id="enable-tls"></span><h3>Enabling TLS in a new cluster</h3>
<p>To set a new cluster to use TLS, use the <code class="docutils literal"><span class="pre">-t</span></code> flag on <code class="docutils literal"><span class="pre">make-public.py</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>user@host1$ sudo /usr/lib/foundationdb/make-public.py -t
/etc/foundationdb/fdb.cluster is now using address 10.0.1.1 (TLS enabled)
</pre></div>
</div>
<p>This will configure the new cluster to communicate with TLS.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Depending on your operating system, version and configuration, there may be a firewall in place that prevents external access to certain ports. If necessary, please consult the appropriate documentation for your OS and ensure that all machines in your cluster can reach the ports configured in your <a class="reference internal" href="configuration.html#foundationdb-conf"><span class="std std-ref">configuration file</span></a>.</p>
</div>
</div>
</div>
<div class="section" id="converting-an-existing-cluster-to-use-tls">
<span id="converting-existing-cluster"></span><h2>Converting an existing cluster to use TLS</h2>
<p>Enabling TLS on an existing (non-TLS) cluster cannot be accomplished without downtime because all processes must have TLS enabled to communicate. At startup, each server process enables TLS if the addresses in its cluster file are TLS-enabled. As a result, server processes must be stopped and restarted to convert them to use TLS. To convert the cluster to TLS in the most conservative way:</p>
<ol class="arabic simple">
<li>Stop all FoundationDB clients and <a class="reference internal" href="administration.html#administration-running-foundationdb"><span class="std std-ref">server processes</span></a> in the cluster.</li>
<li>Change all cluster files to have the <code class="docutils literal"><span class="pre">:tls</span></code> suffix for each coordinator.</li>
<li>Restart the cluster and the clients.</li>
</ol>
</div>
<div class="section" id="configuring-the-tls-plugin">
<span id="configuring-tls-plugin"></span><h2>Configuring the TLS Plugin</h2>
<p>The location and operation of the TLS plugin are configured through four settings. These settings can be provided as command-line options, client options, or environment variables, and are named as follows:</p>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="16%" />
<col width="23%" />
<col width="41%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Command-line Option</th>
<th class="head">Client Option</th>
<th class="head">Environment Variable</th>
<th class="head">Purpose</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">tls_plugin</span></code></td>
<td><code class="docutils literal"><span class="pre">TLS_plugin</span></code></td>
<td><code class="docutils literal"><span class="pre">FDB_TLS_PLUGIN</span></code></td>
<td>Path to the file to be loaded as the TLS plugin</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">tls_certificate_file</span></code></td>
<td><code class="docutils literal"><span class="pre">TLS_cert_path</span></code></td>
<td><code class="docutils literal"><span class="pre">FDB_TLS_CERTIFICATE_FILE</span></code></td>
<td>Path to the file from which the local certificates
can be loaded, used by the plugin</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">tls_key_file</span></code></td>
<td><code class="docutils literal"><span class="pre">TLS_key_path</span></code></td>
<td><code class="docutils literal"><span class="pre">FDB_TLS_KEY_FILE</span></code></td>
<td>Path to the file from which to load the private
key, used by the plugin</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">tls_verify_peers</span></code></td>
<td><code class="docutils literal"><span class="pre">TLS_verify_peers</span></code></td>
<td><code class="docutils literal"><span class="pre">FDB_TLS_VERIFY_PEERS</span></code></td>
<td>The byte-string for the verification of peer
certificates and sessions, used by the plugin</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">tls_password</span></code></td>
<td><code class="docutils literal"><span class="pre">TLS_password</span></code></td>
<td><code class="docutils literal"><span class="pre">FDB_TLS_PASSWORD</span></code></td>
<td>The byte-string representing the passcode for
unencrypting the private key</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">tls_ca_file</span></code></td>
<td><code class="docutils literal"><span class="pre">TLS_ca_path</span></code></td>
<td><code class="docutils literal"><span class="pre">FDB_TLS_CA_FILE</span></code></td>
<td>Path to the file containing the CA certificates
to trust</td>
</tr>
</tbody>
</table>
<p>The value for each setting can be specified in more than one way.  The actual valued used is determined in the following order:</p>
<ol class="arabic simple">
<li>An explicitly specified value as a command-line option or client option, if one is given;</li>
<li>The value of the environment variable, if one has been set;</li>
<li>The default value</li>
</ol>
<p>As with all other command-line options to <code class="docutils literal"><span class="pre">fdbserver</span></code>, the TLS settings can be specified in the <a class="reference internal" href="configuration.html#foundationdb-conf-fdbserver"><span class="std std-ref">[fdbserver] section of the configuration file</span></a>.</p>
<p>The settings for certificate file, key file, peer verification, password and CA file are interpreted by the loaded plugin.</p>
<div class="section" id="default-values">
<h3>Default Values</h3>
<div class="section" id="plugin-default-location">
<h4>Plugin default location</h4>
<p>Similarly, if a value is not specified for the parameter <code class="docutils literal"><span class="pre">tls_plugin</span></code>, the file will be specified by the environment variable <code class="docutils literal"><span class="pre">FDB_TLS_PLUGIN</span></code> or, if this variable is not set, the system-dependent location:</p>
<blockquote>
<div><ul class="simple">
<li>Linux: <code class="docutils literal"><span class="pre">/usr/lib/foundationdb/plugins/fdb-libressl-plugin.so</span></code></li>
<li>macOS: <code class="docutils literal"><span class="pre">/usr/local/foundationdb/plugins/fdb-libressl-plugin.dylib</span></code></li>
<li>Windows: <code class="docutils literal"><span class="pre">C:\Program</span> <span class="pre">Files\foundationdb\plugins\fdb-libressl-plugin.dll</span></code></li>
</ul>
</div></blockquote>
<p>On Windows, this location will be relative to the chosen installation location. The environment variable <code class="docutils literal"><span class="pre">FOUNDATIONDB_INSTALL_PATH</span></code> will be used in place of <code class="docutils literal"><span class="pre">C:\Program</span> <span class="pre">Files\foundationdb\</span></code> to determine this location.</p>
</div>
<div class="section" id="certificate-file-default-location">
<h4>Certificate file default location</h4>
<p>The default behavior when the certificate or key file is not specified is to look for a file named <code class="docutils literal"><span class="pre">fdb.pem</span></code> in the current working directory. If this file is not present, an attempt is made to load a file from a system-dependent location:</p>
<blockquote>
<div><ul class="simple">
<li>Linux: <code class="docutils literal"><span class="pre">/etc/foundationdb/fdb.pem</span></code></li>
<li>macOS: <code class="docutils literal"><span class="pre">/usr/local/etc/foundationdb/fdb.pem</span></code></li>
<li>Windows: <code class="docutils literal"><span class="pre">C:\ProgramData\foundationdb\fdb.pem</span></code></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="default-peer-verification">
<h4>Default Peer Verification</h4>
<p>The default peer verification is <code class="docutils literal"><span class="pre">Check.Valid=0</span></code>.</p>
</div>
<div class="section" id="default-password">
<h4>Default Password</h4>
<p>There is no default password. If no password is specified, the plugin assumes that private key is unencrypted.</p>
</div>
<div class="section" id="ca-file-default-location">
<h4>CA file default location</h4>
<p>If a value is not specified, the plugin searches for certs in the default openssl certs location.</p>
</div>
</div>
<div class="section" id="parameters-and-client-bindings">
<h3>Parameters and client bindings</h3>
<p>When loading a TLS plugin from a non-default location when using a client binding, the <code class="docutils literal"><span class="pre">TLS_PLUGIN</span></code> network option must be specified before any other TLS option. Because a loaded TLS plugin is allowed to reject the values specified in the other options, the plugin load operation will be forced by specifying one of the other options, if it not already specified.</p>
</div>
</div>
<div class="section" id="the-default-libressl-based-plugin">
<h2>The default LibreSSL-based plugin</h2>
<p>FoundationDB offers a TLS plugin based on the LibreSSL library. By default, it will be loaded automatically when participating in a TLS-enabled cluster.</p>
<p>For the plugin to operate, each process (both server and client) must have an X509 certificate, its corresponding private key, and potentially the certificates with which is was signed. When a process begins to communicate with a FoundationDB server process, the peer&#8217;s certificate is checked to see if it is trusted and the fields of the peer certificate are verified. Peers must share the same root trusted certificate, and they must both present certificates whose signing chain includes this root certificate.</p>
<p>If the local certificate and chain is invalid, a FoundationDB server process bound to a TLS address will not start. In the case of invalid certificates on a client, the client will be able to start but will be unable to connect any TLS-enabled cluster.</p>
<div class="section" id="formats">
<h3>Formats</h3>
<p>The LibreSSL plugin can read certificates and their private keys in base64-encoded DER-formatted X.509 format (which is known as PEM). A PEM file can contain both certificates and a private key or the two can be stored in separate files.</p>
</div>
<div class="section" id="required-files">
<h3>Required files</h3>
<p>A single file can contain the information as described in both of the following sections.</p>
<div class="section" id="the-certificate-file">
<span id="tls-certificate-file"></span><h4>The certificate file</h4>
<p>A file must be supplied that contains an ordered list of certificates. The first certificate is the process&#8217; own certificate. Each following certificate must sign the one preceding it.</p>
<p>All but the last certificate are provided to peers during TLS handshake as the certificate chain.</p>
<p>The last certificate in the list is the trusted certificate.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If the certificate list contains only one certificate, that certificate <em>must</em> be self-signed and will be used as both the certificate chain and the trusted certificate.</p>
</div>
<p>Each of these certificates must be in the form:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">--------</span><span class="n">BEGIN</span> <span class="n">CERTIFICATE</span><span class="o">--------</span>
<span class="n">xxxxxxxxxxxxxxx</span>
<span class="o">--------</span><span class="n">END</span> <span class="n">CERTIFICATE</span><span class="o">--------</span>
</pre></div>
</div>
</div>
<div class="section" id="the-key-file">
<span id="tls-key-file"></span><h4>The key file</h4>
<p>The key file must contain the private key corresponding to the process&#8217; own certificate. The private key must be in PKCS#8 format, which means that it must be surrounded by:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">-----</span><span class="n">BEGIN</span> <span class="n">PRIVATE</span> <span class="n">KEY</span><span class="o">-----</span>
<span class="n">xxxxxxxxxxxxxxx</span>
<span class="o">-----</span><span class="n">END</span> <span class="n">PRIVATE</span> <span class="n">KEY</span><span class="o">-----</span>
</pre></div>
</div>
<p>It can optionally be encrypted by the password provided to tls_password.</p>
</div>
</div>
<div class="section" id="certificate-creation">
<h3>Certificate creation</h3>
<p>If your organization already makes use of certificates for access control and securing communications, you should ask your security expert for organizational procedure for obtaining and verifying certificates. If the goal of enabling TLS is to make sure that only known machines can join or access the FoundationDB cluster and for securing communications, then creating your own certificates can serve these purposes.</p>
<p>The following set of commands uses the OpenSSL command-line tools to create a self-signed certificate and private key. The certificate is then joined with the private key in the output <code class="docutils literal"><span class="pre">fdb.pem</span></code> file:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">user</span><span class="nd">@host</span><span class="p">:</span><span class="o">&gt;</span> <span class="n">openssl</span> <span class="n">req</span> <span class="o">-</span><span class="n">x509</span> <span class="o">-</span><span class="n">nodes</span> <span class="o">-</span><span class="n">days</span> <span class="mi">365</span> <span class="o">-</span><span class="n">newkey</span> <span class="n">rsa</span><span class="p">:</span><span class="mi">2048</span> <span class="o">-</span><span class="n">keyout</span> <span class="n">private</span><span class="o">.</span><span class="n">key</span> <span class="o">-</span><span class="n">out</span> <span class="n">cert</span><span class="o">.</span><span class="n">crt</span>
<span class="n">user</span><span class="nd">@host</span><span class="p">:</span><span class="o">&gt;</span> <span class="n">cat</span> <span class="n">cert</span><span class="o">.</span><span class="n">crt</span> <span class="n">private</span><span class="o">.</span><span class="n">key</span> <span class="o">&gt;</span> <span class="n">fdb</span><span class="o">.</span><span class="n">pem</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="peer-verification">
<h2>Peer verification</h2>
<p>A FoundationDB server or client will only communicate with peers that present a certificate chain that meets the verification requirements. By default, the only requirement is that the provided certificate chain ends in a certificate signed by the local trusted certificate.</p>
<div class="section" id="certificate-field-verification">
<span id="tls-verify-peers"></span><h3>Certificate field verification</h3>
<p>With a peer verification string, FoundationDB servers and clients can adjust what is required of the certificate chain presented by a peer. These options can make the certificate requirements more rigorous or more lenient. You can specify multiple verification strings by providing additional tls_verify_peers command line arguments or concatenating them with <code class="docutils literal"><span class="pre">|</span></code>. All <code class="docutils literal"><span class="pre">,</span></code> or <code class="docutils literal"><span class="pre">|</span></code> in the verify peers fields should be escaped with <code class="docutils literal"><span class="pre">\</span></code>.</p>
<div class="section" id="turning-down-the-validation">
<h4>Turning down the validation</h4>
<p>If the default checking of the certificate chain is too stringent, the verification string can contain settings to weaken what certificates are accepted.</p>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Setting</th>
<th class="head">Result</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">Check.Valid=0</span></code></td>
<td>Sets the current process to disable all further verification
of a peer certificate.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">Check.Unexpired=0</span></code></td>
<td>Disables date checking of peer certificates. If the clocks in
the cluster and between the clients and servers are not to be
trusted, setting this value to <code class="docutils literal"><span class="pre">0</span></code> can allow communications
to proceed.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="adding-verification-requirements">
<h4>Adding verification requirements</h4>
<p>Requirements can be placed on the fields of the Issuer and Subject DNs in the peer&#8217;s own certificate. These requirements take the form of a comma-separated list of conditions. Each condition takes the form of <code class="docutils literal"><span class="pre">field=value</span></code>. Only certain fields from a DN can be matched against.</p>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="76%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Field</th>
<th class="head">Well known name</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">CN</span></code></td>
<td>Common Name</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">C</span></code></td>
<td>County</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">L</span></code></td>
<td>Locality</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">ST</span></code></td>
<td>State</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">O</span></code></td>
<td>Organization</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">OU</span></code></td>
<td>Organizational Unit</td>
</tr>
</tbody>
</table>
<p>The field of each condition may optionally have a DN prefix, which is otherwise considered to be for the Subject DN.</p>
<table border="1" class="docutils">
<colgroup>
<col width="78%" />
<col width="22%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prefix</th>
<th class="head">DN</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">S.</span></code>, <code class="docutils literal"><span class="pre">Subject.</span></code>, or none</td>
<td>Subject</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">I.</span></code>, or <code class="docutils literal"><span class="pre">Issuer.</span></code></td>
<td>Issuer</td>
</tr>
</tbody>
</table>
<p>Additionally, the verification can be restricted to certificates signed by a given root CA with the field <code class="docutils literal"><span class="pre">Root.CN</span></code>. This allows you to have different requirements for different root chains.</p>
<p>The value of a condition must be specified in a form derived from a subset of <a class="reference external" href="http://www.ietf.org/rfc/rfc4514.txt">RFC 4514</a>. Specifically, the &#8220;raw&#8221; notation (a value starting with the <code class="docutils literal"><span class="pre">#</span></code> character) is not accepted. Other escaping mechanisms, including specifying characters by hex notation, are allowed. The specified field&#8217;s value must exactly match the value in the peer&#8217;s certificate.</p>
<p>By default, the fields of a peer certificate&#8217;s DNs are not examined.</p>
</div>
<div class="section" id="verification-examples">
<h4>Verification Examples</h4>
<p>A verification string can be of the form:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Check</span><span class="o">.</span><span class="n">Unexpired</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">I</span><span class="o">.</span><span class="n">C</span><span class="o">=</span><span class="n">US</span><span class="p">,</span><span class="n">C</span><span class="o">=</span><span class="n">US</span><span class="p">,</span><span class="n">S</span><span class="o">.</span><span class="n">O</span><span class="o">=</span><span class="n">XYZCorp</span>\<span class="p">,</span> <span class="n">LLC</span>
</pre></div>
</div>
<p>This verification string would:</p>
<ul class="simple">
<li>Skip the check on all peer certificates that the certificate is not yet expired</li>
<li>Require that the Issuer have a Country field of <code class="docutils literal"><span class="pre">US</span></code></li>
<li>Require that the Subject have a Country field of <code class="docutils literal"><span class="pre">US</span></code></li>
<li>Require that the Subject have a Organization field of <code class="docutils literal"><span class="pre">XYZCorp,</span> <span class="pre">LLC</span></code></li>
</ul>
</div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
<div id="sourcelink">
  <a href="_sources/tls.rst.txt"
     rel="nofollow">Source</a>
</div>
      
    </p>
    <p>
        &copy; Copyright 2013-2018 Apple, Inc and the FoundationDB project authors.<br/>
      Last updated on Jun 26, 2018.<br/>
    </p>
  </div>
</footer>
  </body>
</html>